<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coordinate Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.2/proj4.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea, input[type="file"] { width: 100%; margin-bottom: 10px; }
        button { padding: 10px; margin: 5px; }
        pre { background: #f4f4f4; padding: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>

    <h2>Paste or Upload Coordinates</h2>
    <input type="file" id="fileInput" accept=".csv,.txt" onchange="handleFileUpload(event)">
    <textarea id="input" placeholder="Paste your two-column coordinates here..."></textarea>
    <button onclick="convertCoordinates()">Convert to UTM32N</button>
    <h3>Converted Coordinates:</h3>
    <pre id="output"></pre>

    <script>
        // Define Projections
        const projWGS84 = "EPSG:4326"; // WGS84 Lat/Lon
        const projGK4 = "+proj=tmerc +lat_0=0 +lon_0=12 +k=1.0000 +x_0=4500000 +y_0=0 +datum=WGS84"; // GK4 Example
        const projGoogle = "EPSG:3857"; // Google Maps Web Mercator
        const projUTM32N = "EPSG:32632"; // UTM Zone 32N

        function detectProjection(x, y) {
            if (Math.abs(x) <= 180 && Math.abs(y) <= 90) return projWGS84; // WGS84 Lat/Lon
            if (Math.abs(y) <= 180 && Math.abs(x) <= 90) return projWGS84; // Swapped Lat/Lon -> Fix!
            if (x > 2000000 && x < 5000000) return projGK4; // Gauss-KrÃ¼ger (example check)
            return projGoogle; // Default to Google Maps Web Mercator
        }

        function convertCoordinates() {
            const inputText = document.getElementById("input").value.trim();
            if (!inputText) return alert("Please paste coordinates first!");

            const lines = inputText.split("\n");
            let results = "Easting (X)\tNorthing (Y)\n";

            for (let line of lines) {
                let values = line.trim().split(/\s+/); // Split by any whitespace
                if (values.length < 2) continue; // Skip empty lines

                let x = parseFloat(values[0]);
                let y = parseFloat(values[1]);

                if (isNaN(x) || isNaN(y)) continue; // Skip invalid rows

                let detectedProj = detectProjection(x, y);

                // Auto-fix swapped coordinates
                if (detectedProj === projWGS84 && Math.abs(y) > 180) {
                    [x, y] = [y, x]; // Swap back to correct order
                }

                let [utmX, utmY] = proj4(detectedProj, projUTM32N, [x, y]);

                results += `${utmX.toFixed(2)}\t${utmY.toFixed(2)}\n`;
            }

            document.getElementById("output").textContent = results;
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById("input").value = e.target.result;
            };
            reader.readAsText(file);
        }
    </script>

</body>
</html>
